name: Build CV with AcademicCV.jl
on:
  push:
    branches-ignore:
    - '/pdflatex'
  schedule:
    - cron: "0 0 * * *" # Run at 00:00 every day
jobs:
  build_cv:
    runs-on: ubuntu-latest
    steps:
      - name: Set up Git repository
        uses: actions/checkout@v4
      
      - name: Setup Julia
        uses: julia-actions/setup-julia@v2
        with:
          version: '1.10'
      
      - name: Install LaTeX
        run: |
          sudo apt-get update
          sudo apt-get install -y texlive-latex-base texlive-latex-extra
      
      - name: Install AcademicCV.jl
        run: |
          julia --project=. -e 'using Pkg; Pkg.add(url="https://github.com/md-arif-shaikh/AcademicCV.jl")'
      
      - name: Build CV
        run: |
          julia --project=. scripts/build_cv.jl
      
      - name: Commit to orphan branch
        run: |
          cp _data/arif/cv_arif.pdf cv_arif.pdf
          git checkout --orphan pdflatex
          git rm -rf .
          mv cv_arif.pdf .
          git add cv_arif.pdf
          git -c user.name='GitHub Action' -c user.email='action@github.com' commit -m "Built CV with AcademicCV.jl"
      
      - name: Push changes
        uses: ad-m/github-push-action@master
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          branch: pdflatex
          force: true
      
